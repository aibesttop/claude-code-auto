# Claude Code 自主决策工作流系统

## 核心理念

**为什么我需要去写第二次、第三次、第四次的内容在输入框中？**

让 Claude Code 24小时无限工作，自主决策下一步行动！

## 系统架构与工作原理

这是一个真正的 AI 自驱动系统，通过三个步骤的循环实现完全自主的工作流：

### 工作流程详解

```
┌─────────────────────────────────────────────────────────────┐
│                     主控制器 (main.py)                        │
├─────────────────────────────────────────────────────────────┤
│  1. 执行 Step 1 → 初始化任务并建立会话                        │
│  2. 执行 Step 3 → 进入自主循环模式                            │
└─────────────────────────┬───────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────┐
│                   自主循环 (Step 3)                          │
├─────────────────────────────────────────────────────────────┤
│  WHILE True:                                                │
│  ├─ 调用 Step 2 → 智能分析并决策                             │
│  ├─ 发送决策结果到 Claude                                   │
│  ├─ 保存会话状态                                           │
│  └─ 检查是否需要退出循环                                    │
└─────────────────────────┬───────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────┐
│                  智能决策引擎 (Step 2)                        │
├─────────────────────────────────────────────────────────────┤
│  1. 创建工作目录镜像 (用于分析)                             │
│  2. 向 Claude 发送分析请求：                                 │
│     - 目标是否已完成？                                       │
│     - 下一步应该做什么？                                     │
│  3. 接收 JSON 格式的决策结果：                              │
│     - completed: 是否完成                                   │
│     - next_prompt: 下一步行动指令                           │
│     - analysis: 状态分析                                    │
└─────────────────────────────────────────────────────────────┘
```

### 核心创新点

#### 1. **会话持久化机制**
- Step 1 创建初始会话并保存 session_id
- Step 3 每次都恢复之前的会话状态
- 确保 Claude 记住所有历史对话

#### 2. **镜像分析技术**
- Step 2 创建工作目录的镜像副本
- 在镜像环境中分析任务进度
- 避免污染实际工作目录

#### 3. **自主决策循环**
```
执行 → 分析 → 决策 → 再执行
```
- 每个循环都基于前一次的结果
- Claude 自主判断下一步行动
- 无需人工干预

### 实际运行示例

**初始目标**: "写一个python程序来设计一个加法"

**自主决策过程**:
1. **第1轮**: Claude 分析后生成设计文档
2. **第2轮**: 检查文档，发现需要实际代码
3. **第3轮**: 编写加法程序代码
4. **第4轮**: 检查代码，建议添加测试
5. **第5轮**: 编写测试用例
6. **第6轮**: 检查完成度，任务结束

### 技术特点

- **零人工干预**: 启动后完全自主运行
- **状态保持**: 通过 session_id 维护连续性
- **智能分析**: Claude 自主评估任务进度
- **动态决策**: 根据实际情况调整策略
- **断点续传**: 可随时中断和恢复

### 使用场景

- 复杂编程任务的自动化完成
- 文档生成和优化
- 代码审查和改进
- 持续集成和部署
- 自动化测试流程

## 快速开始

```bash
# 安装依赖
pip install claude-code-sdk

# 启动自主工作流
python main.py
```

程序将自动：
1. 初始化任务
2. 进入自主循环
3. 持续工作直到任务完成

## 配置说明

- 修改 `main.py` 中的 `goal` 设置任务目标
- 工作目录: `/Users/zhangsan/cccc/demo_act`
- 镜像目录: `/Users/zhangsan/cccc/mirror`

## 未来发展

- [ ] 支持多任务并行
- [ ] 添加任务优先级
- [ ] Web 监控界面
- [ ] 错误恢复机制
- [ ] 分布式执行

---

这个系统的核心价值：**让 AI 真正自主地思考和决策，而不是简单地执行预设脚本。**
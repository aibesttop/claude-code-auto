# ğŸŒ Web ç›‘æ§é¢æ¿ä½¿ç”¨æŒ‡å—

## ğŸ“‹ ç›®å½•

1. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
2. [åŠŸèƒ½æ¦‚è§ˆ](#åŠŸèƒ½æ¦‚è§ˆ)
3. [API ç«¯ç‚¹æ–‡æ¡£](#api-ç«¯ç‚¹æ–‡æ¡£)
4. [ä½¿ç”¨åœºæ™¯](#ä½¿ç”¨åœºæ™¯)
5. [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
6. [é«˜çº§ç”¨æ³•](#é«˜çº§ç”¨æ³•)

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³•1: ä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰

åŒæ—¶å¯åŠ¨å·¥ä½œæµå’Œ Web ç›‘æ§ï¼š

```bash
python run_with_monitor.py
```

ç„¶åè®¿é—®: **http://localhost:8000**

### æ–¹æ³•2: åˆ†åˆ«å¯åŠ¨

**ç»ˆç«¯1 - å¯åŠ¨å·¥ä½œæµ:**
```bash
python main_v2.py
```

**ç»ˆç«¯2 - å¯åŠ¨ Web ç›‘æ§:**
```bash
python web_server.py
```

ç„¶åè®¿é—®: **http://localhost:8000**

### æ–¹æ³•3: ä»…ç›‘æ§æ¨¡å¼

```bash
python run_with_monitor.py --web-only
```

ç”¨äºæŸ¥çœ‹å·²è¿è¡Œçš„å·¥ä½œæµçŠ¶æ€ã€‚

---

## ğŸ“Š åŠŸèƒ½æ¦‚è§ˆ

### 1. å®æ—¶çŠ¶æ€ç›‘æ§

- âœ… **æ‰§è¡Œæ¦‚è§ˆ**: å½“å‰è¿­ä»£ã€æˆåŠŸç‡ã€ä¼šè¯ID
- âœ… **è¿›åº¦è¿½è¸ª**: å¯è§†åŒ–è¿›åº¦æ¡ã€å®Œæˆæƒ…å†µ
- âœ… **ç»Ÿè®¡æ•°æ®**: æ€»è¿­ä»£ã€æˆåŠŸ/å¤±è´¥æ¬¡æ•°ã€æˆåŠŸç‡
- âœ… **æ—¶é—´ä¿¡æ¯**: æ€»è¿è¡Œæ—¶é•¿ã€å¹³å‡æ—¶é•¿ã€æœ€åæ›´æ–°

### 2. å®æ—¶æ—¥å¿—æµ

- ğŸ“œ æœ€è¿‘50è¡Œæ—¥å¿—å®æ—¶æ˜¾ç¤º
- ğŸ“ˆ è‡ªåŠ¨æ»šåŠ¨åˆ°æœ€æ–°æ—¥å¿—
- ğŸ”„ æ¯30ç§’è‡ªåŠ¨åˆ·æ–°

### 3. æ‰§è¡Œå†å²

- ğŸ“ æœ€è¿‘10æ¬¡è¿­ä»£è®°å½•
- âœ… æˆåŠŸ/å¤±è´¥çŠ¶æ€æ ‡è®°
- â±ï¸ æ¯æ¬¡è¿­ä»£è€—æ—¶
- ğŸ› é”™è¯¯ä¿¡æ¯æ˜¾ç¤º

### 4. æ§åˆ¶æ“ä½œ

- ğŸ”„ **åˆ·æ–°æ•°æ®**: ç«‹å³æ›´æ–°æ‰€æœ‰ä¿¡æ¯
- ğŸ›‘ **ç´§æ€¥åœæ­¢**: å®‰å…¨åœæ­¢å·¥ä½œæµ
- ğŸ“ **æŸ¥çœ‹æ—¥å¿—**: åœ¨æ–°çª—å£æŸ¥çœ‹å®Œæ•´æ—¥å¿—

### 5. WebSocket å®æ—¶æ¨é€

- âš¡ å®æ—¶çŠ¶æ€æ›´æ–°ï¼ˆ2ç§’é—´éš”ï¼‰
- ğŸ’“ è¿æ¥çŠ¶æ€æŒ‡ç¤º
- ğŸ” è‡ªåŠ¨é‡è¿ï¼ˆ5ç§’ï¼‰

---

## ğŸ”Œ API ç«¯ç‚¹æ–‡æ¡£

### åŸºç¡€ç«¯ç‚¹

#### GET `/`
è¿”å›ç›‘æ§é¢æ¿ HTML

#### GET `/api/health`
å¥åº·æ£€æŸ¥

**å“åº”:**
```json
{
  "status": "healthy",
  "timestamp": "2025-01-21T10:30:45.123456",
  "version": "2.0"
}
```

---

### é…ç½®ç›¸å…³

#### GET `/api/config`
è·å–å½“å‰é…ç½®

**å“åº”:**
```json
{
  "task": {
    "goal": "è°ƒç ”ä¸€ä¸‹æ…¢æ€§ç—…",
    "initial_prompt": "..."
  },
  "safety": {
    "max_iterations": 50,
    "max_duration_hours": 8
  },
  "directories": {
    "work_dir": "demo_act",
    "mirror_dir": "demo_mirror"
  }
}
```

---

### çŠ¶æ€ç›¸å…³

#### GET `/api/status`
è·å–å½“å‰å·¥ä½œæµçŠ¶æ€

**å“åº”:**
```json
{
  "exists": true,
  "session_id": "abc123...",
  "goal": "è°ƒç ”ä¸€ä¸‹æ…¢æ€§ç—…",
  "status": "running",
  "current_iteration": 5,
  "max_iterations": 50,
  "progress_percentage": 10.0,
  "start_time": "2025-01-21T10:00:00",
  "last_update": "2025-01-21T10:30:00",
  "total_duration_seconds": 1800,
  "successful_iterations": 4,
  "failed_iterations": 1,
  "success_rate": 80.0,
  "average_iteration_time": 360.0,
  "error_count": 1,
  "last_error": "..."
}
```

#### GET `/api/history?limit=10`
è·å–æ‰§è¡Œå†å²

**å‚æ•°:**
- `limit` (å¯é€‰): è¿”å›è®°å½•æ•°ï¼Œé»˜è®¤10

**å“åº”:**
```json
{
  "total_count": 5,
  "limit": 10,
  "history": [
    {
      "iteration": 1,
      "timestamp": "2025-01-21T10:05:00",
      "decision": {...},
      "duration_seconds": 45.2,
      "success": true,
      "error_message": null
    }
  ]
}
```

#### GET `/api/stats`
è·å–ç»Ÿè®¡ä¿¡æ¯

**å“åº”:**
```json
{
  "overview": {
    "total_iterations": 5,
    "successful": 4,
    "failed": 1,
    "success_rate": 80.0
  },
  "timing": {
    "total_duration_seconds": 1800,
    "average_iteration_time": 360,
    "min_iteration_time": 30,
    "max_iteration_time": 500
  },
  "progress": {
    "current_iteration": 5,
    "max_iterations": 50,
    "progress_percentage": 10.0,
    "estimated_remaining_time": 16200
  }
}
```

---

### æ—¥å¿—ç›¸å…³

#### GET `/api/logs?lines=50&log_type=main`
è·å–æ—¥å¿—å†…å®¹

**å‚æ•°:**
- `lines` (å¯é€‰): è¿”å›è¡Œæ•°ï¼Œé»˜è®¤50
- `log_type` (å¯é€‰): æ—¥å¿—ç±»å‹ `main`(é»˜è®¤) æˆ– `error`

**å“åº”:**
```json
{
  "log_type": "main",
  "lines": 50,
  "total_lines": 1000,
  "logs": [
    "2025-01-21 10:30:45 | INFO | å¼€å§‹ç¬¬ 5 è½®è¿­ä»£",
    "..."
  ]
}
```

---

### æ§åˆ¶ç›¸å…³

#### POST `/api/control/emergency-stop`
è§¦å‘ç´§æ€¥åœæ­¢

**å“åº”:**
```json
{
  "success": true,
  "message": "ç´§æ€¥åœæ­¢ä¿¡å·å·²å‘é€ï¼Œç³»ç»Ÿå°†åœ¨ä¸‹ä¸€è½®è¿­ä»£å‰å®‰å…¨é€€å‡º"
}
```

#### DELETE `/api/control/emergency-stop`
å–æ¶ˆç´§æ€¥åœæ­¢

**å“åº”:**
```json
{
  "success": true,
  "message": "ç´§æ€¥åœæ­¢ä¿¡å·å·²å–æ¶ˆ"
}
```

---

### WebSocket

#### WS `/ws`
WebSocket è¿æ¥ï¼Œç”¨äºå®æ—¶æ¨é€

**å®¢æˆ·ç«¯å‘é€:**
- `"ping"` - å¿ƒè·³æ£€æµ‹
- `"status"` - è¯·æ±‚çŠ¶æ€æ›´æ–°

**æœåŠ¡å™¨æ¨é€:**
```json
{
  "type": "status_update",
  "timestamp": "2025-01-21T10:30:45",
  "data": {
    "current_iteration": 5,
    "status": "running",
    "progress": 10.0,
    "last_update": "2025-01-21T10:30:00"
  }
}
```

```json
{
  "type": "heartbeat"
}
```

```json
{
  "type": "control",
  "action": "emergency_stop",
  "timestamp": "2025-01-21T10:31:00",
  "message": "ç´§æ€¥åœæ­¢ä¿¡å·å·²å‘é€"
}
```

---

## ğŸ’¡ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1: ç›‘æ§é•¿æœŸè¿è¡Œä»»åŠ¡

```bash
# å¯åŠ¨å·¥ä½œæµ + ç›‘æ§
python run_with_monitor.py

# æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:8000
# éšæ—¶æŸ¥çœ‹è¿›åº¦ã€æ—¥å¿—ã€ç»Ÿè®¡
```

### åœºæ™¯2: è¿œç¨‹ç›‘æ§

1. åœ¨æœåŠ¡å™¨ä¸Šå¯åŠ¨:
```bash
python web_server.py
```

2. ä¿®æ”¹ `web_server.py` ä¸­çš„ host:
```python
uvicorn.run(app, host="0.0.0.0", port=8000)
```

3. é€šè¿‡ `http://<æœåŠ¡å™¨IP>:8000` è®¿é—®

âš ï¸ **å®‰å…¨æç¤º**: ç”Ÿäº§ç¯å¢ƒå»ºè®®æ·»åŠ è®¤è¯ï¼

### åœºæ™¯3: è°ƒè¯•æ¨¡å¼

```bash
# åªå¯åŠ¨ç›‘æ§ï¼ˆä¸è¿è¡Œå·¥ä½œæµï¼‰
python run_with_monitor.py --web-only

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯æ‰‹åŠ¨æ§åˆ¶å·¥ä½œæµ
python main_v2.py --skip-init
```

### åœºæ™¯4: API é›†æˆ

```python
import requests

# è·å–çŠ¶æ€
response = requests.get("http://localhost:8000/api/status")
status = response.json()

print(f"è¿›åº¦: {status['progress_percentage']}%")
print(f"çŠ¶æ€: {status['status']}")

# è§¦å‘ç´§æ€¥åœæ­¢
requests.post("http://localhost:8000/api/control/emergency-stop")
```

---

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜1: ç«¯å£è¢«å ç”¨

```
Error: Address already in use
```

**è§£å†³æ–¹æ¡ˆ:**

```bash
# Windows
netstat -ano | findstr :8000
taskkill /PID <PID> /F

# Linux/Mac
lsof -i :8000
kill -9 <PID>
```

æˆ–ä¿®æ”¹ç«¯å£:
```python
# web_server.py
uvicorn.run(app, host="0.0.0.0", port=8001)
```

### é—®é¢˜2: WebSocket è¿æ¥å¤±è´¥

**ç—‡çŠ¶**: é¡µé¢æ˜¾ç¤º"æœªè¿æ¥"

**è§£å†³æ–¹æ¡ˆ:**
1. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
2. ç¡®è®¤æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ
3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯

### é—®é¢˜3: çŠ¶æ€ä¸æ›´æ–°

**è§£å†³æ–¹æ¡ˆ:**
1. ç‚¹å‡»"åˆ·æ–°æ•°æ®"æŒ‰é’®
2. æ£€æŸ¥ `workflow_state.json` æ–‡ä»¶æ˜¯å¦å­˜åœ¨
3. ç¡®è®¤å·¥ä½œæµæ­£åœ¨è¿è¡Œ

### é—®é¢˜4: æ—¥å¿—ä¸ºç©º

**è§£å†³æ–¹æ¡ˆ:**
1. æ£€æŸ¥ `logs/` ç›®å½•æ˜¯å¦å­˜åœ¨
2. ç¡®è®¤å·¥ä½œæµå·²ç»è¿è¡Œè¿‡
3. æ£€æŸ¥æ—¥å¿—æ–‡ä»¶æƒé™

---

## ğŸš€ é«˜çº§ç”¨æ³•

### è‡ªå®šä¹‰ç›‘æ§é¢æ¿

ç¼–è¾‘ `templates/dashboard.html` è‡ªå®šä¹‰å¤–è§‚:

```html
<!-- ä¿®æ”¹åˆ·æ–°é—´éš”ï¼ˆé»˜è®¤5ç§’ï¼‰ -->
<script>
setInterval(refreshData, 10000);  // æ”¹ä¸º10ç§’
</script>

<!-- ä¿®æ”¹æ—¥å¿—è¡Œæ•°ï¼ˆé»˜è®¤50ï¼‰ -->
<script>
await fetch('/api/logs?lines=100');  // æ”¹ä¸º100è¡Œ
</script>
```

### æ·»åŠ è‡ªå®šä¹‰ API ç«¯ç‚¹

åœ¨ `web_server.py` ä¸­æ·»åŠ :

```python
@app.get("/api/custom")
async def custom_endpoint():
    # è‡ªå®šä¹‰é€»è¾‘
    return {"custom": "data"}
```

### é›†æˆåˆ°ç°æœ‰ç³»ç»Ÿ

```python
from web_server import app
from fastapi import FastAPI

# æŒ‚è½½åˆ°ç°æœ‰ FastAPI app
existing_app = FastAPI()
existing_app.mount("/workflow", app)
```

### å¯¼å‡ºæ•°æ®

```bash
# å¯¼å‡ºçŠ¶æ€ä¸º JSON
curl http://localhost:8000/api/status > status.json

# å¯¼å‡ºæ—¥å¿—
curl "http://localhost:8000/api/logs?lines=1000" > logs.json

# å¯¼å‡ºå†å²
curl "http://localhost:8000/api/history?limit=100" > history.json
```

### ç›‘æ§å‘Šè­¦

```python
import requests
import time

while True:
    response = requests.get("http://localhost:8000/api/status")
    data = response.json()

    # æ£€æŸ¥é”™è¯¯ç‡
    if data['success_rate'] < 50:
        send_alert("å·¥ä½œæµæˆåŠŸç‡è¿‡ä½ï¼")

    # æ£€æŸ¥æ˜¯å¦å¡ä½
    last_update = datetime.fromisoformat(data['last_update'])
    if (datetime.now() - last_update).seconds > 600:
        send_alert("å·¥ä½œæµå¯èƒ½å¡ä½äº†ï¼")

    time.sleep(60)
```

---

## ğŸ“¸ ç•Œé¢é¢„è§ˆ

### ç›‘æ§é¢æ¿å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤– Claude Workflow Monitor     [è¿è¡Œä¸­] [å·²è¿æ¥]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ æ‰§è¡Œæ¦‚è§ˆ   â”‚  â”‚ è¿›åº¦è¿½è¸ª   â”‚  â”‚ æ§åˆ¶é¢æ¿   â”‚    â”‚
â”‚  â”‚ ä»»åŠ¡: ...  â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘   â”‚  â”‚ [åˆ·æ–°]     â”‚    â”‚
â”‚  â”‚ è¿­ä»£: 5/50 â”‚  â”‚ 10%        â”‚  â”‚ [åœæ­¢]     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Š ç»Ÿè®¡æ•°æ®                                        â”‚
â”‚  [ 5æ€» ] [ 4æˆåŠŸ ] [ 1å¤±è´¥ ] [ 80%æˆåŠŸç‡ ]         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“œ å®æ—¶æ—¥å¿—                                        â”‚
â”‚  2025-01-21 10:30:45 | INFO | å¼€å§‹ç¬¬ 5 è½®è¿­ä»£      â”‚
â”‚  2025-01-21 10:30:50 | INFO | Claude: ...          â”‚
â”‚  ...                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“ æ‰§è¡Œå†å²                                        â”‚
â”‚  âœ… ç¬¬4è½® - æˆåŠŸ (45.2s)                           â”‚
â”‚  âŒ ç¬¬3è½® - å¤±è´¥ (12.1s)                           â”‚
â”‚  ...                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ æœ€ä½³å®è·µ

1. **å§‹ç»ˆå¼€å¯ç›‘æ§**: è¿è¡Œé•¿æœŸä»»åŠ¡æ—¶ä½¿ç”¨ `run_with_monitor.py`
2. **å®šæœŸæŸ¥çœ‹æ—¥å¿—**: åŠæ—¶å‘ç°æ½œåœ¨é—®é¢˜
3. **ç›‘æ§æˆåŠŸç‡**: ä½äº80%éœ€è¦ä»‹å…¥
4. **è®¾ç½®å‘Šè­¦**: å¯¹äºå…³é”®ä»»åŠ¡ï¼Œé…ç½®ç›‘æ§å‘Šè­¦
5. **å®šæœŸå¯¼å‡ºæ•°æ®**: ä¿å­˜å†å²è®°å½•ç”¨äºåˆ†æ

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ä¸»æ–‡æ¡£](README_CN.md)
- [å‡çº§æŒ‡å—](UPGRADE_GUIDE.md)
- [å¿«é€Ÿå¼€å§‹](QUICKSTART_V2.md)
- [API æ–‡æ¡£](http://localhost:8000/docs) (å¯åŠ¨æœåŠ¡å™¨åè®¿é—®)

---

## ğŸ¤ è´¡çŒ®

å‘ç° bug æˆ–æœ‰æ”¹è¿›å»ºè®®ï¼Ÿæ¬¢è¿æäº¤ Issue æˆ– PRï¼

---

**ç‰ˆæœ¬**: v2.0
**æ›´æ–°æ—¥æœŸ**: 2025-01-21
**ä½œè€…**: Claude Code ä¼˜åŒ–å›¢é˜Ÿ

# ğŸš€ ä¼˜åŒ–å‡çº§æŒ‡å—

## ç‰ˆæœ¬ä¿¡æ¯

- **åŸå§‹ç‰ˆæœ¬**: v1.0 (main.py, step1.py, step2.py, step3.py)
- **ä¼˜åŒ–ç‰ˆæœ¬**: v2.0 (main_v2.py, step1_v2.py, step2_v2.py, step3_v2.py)
- **å‡çº§æ—¥æœŸ**: 2025-01-21

---

## ğŸ“‹ ä¼˜åŒ–æ¦‚è§ˆ

æœ¬æ¬¡ä¼˜åŒ–å®Œæˆäº† **P0ï¼ˆå¿…é¡»ç«‹å³ä¿®å¤ï¼‰** å’Œ **P1ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰** é—®é¢˜çš„ä¿®å¤ï¼Œæ˜¾è‘—æå‡äº†ç³»ç»Ÿçš„å¯é æ€§ã€å¯ç»´æŠ¤æ€§å’Œå®‰å…¨æ€§ã€‚

### ä¼˜åŒ–å®Œæˆåº¦

| ä¼˜å…ˆçº§ | é—®é¢˜æ•° | å·²ä¿®å¤ | å®Œæˆç‡ |
|--------|--------|--------|--------|
| P0 - å¿…é¡»ç«‹å³ä¿®å¤ | 3 | 3 | âœ… 100% |
| P1 - é«˜ä¼˜å…ˆçº§ | 4 | 4 | âœ… 100% |
| **æ€»è®¡** | **7** | **7** | **âœ… 100%** |

---

## ğŸ”§ ä¸»è¦æ”¹è¿›ç‚¹

### P0 ä¼˜åŒ– - ç”Ÿäº§çº§é£é™©ä¿®å¤

#### âœ… P0-1: æ— é™å¾ªç¯ä¿æŠ¤æœºåˆ¶

**é—®é¢˜**: å®Œå…¨ä¾èµ– AI è¿”å› `completed=true`ï¼Œå¯èƒ½æ°¸ä¸ç»ˆæ­¢

**è§£å†³æ–¹æ¡ˆ**:
- âœ… æ·»åŠ æœ€å¤§è¿­ä»£æ¬¡æ•°é™åˆ¶ï¼ˆé»˜è®¤50æ¬¡ï¼Œå¯é…ç½®ï¼‰
- âœ… æ·»åŠ æœ€å¤§æ‰§è¡Œæ—¶é•¿é™åˆ¶ï¼ˆé»˜è®¤8å°æ—¶ï¼Œå¯é…ç½®ï¼‰
- âœ… ç´§æ€¥åœæ­¢æ–‡ä»¶æœºåˆ¶ï¼ˆåˆ›å»º `.emergency_stop` æ–‡ä»¶å¯å®‰å…¨åœæ­¢ï¼‰
- âœ… å•æ¬¡è¿­ä»£è¶…æ—¶ä¿æŠ¤ï¼ˆé»˜è®¤30åˆ†é’Ÿï¼‰

**æ–‡ä»¶**: `step3_v2.py`, `config.yaml`

**é…ç½®**:
```yaml
safety:
  max_iterations: 50
  max_duration_hours: 8
  emergency_stop_file: ".emergency_stop"
  iteration_timeout_minutes: 30
```

---

#### âœ… P0-2: å¼ºåŒ– JSON è§£æå™¨

**é—®é¢˜**: ç®€å•å­—ç¬¦ä¸²æŸ¥æ‰¾ï¼Œå¤±è´¥ç‡é«˜è¾¾90%

**è§£å†³æ–¹æ¡ˆ**:
- âœ… å¤šç­–ç•¥è§£æï¼ˆMarkdownä»£ç å— â†’ æ­£åˆ™æå– â†’ é™çº§åˆ†æï¼‰
- âœ… Pydantic Schema éªŒè¯
- âœ… è‡ªåŠ¨é‡è¯•æœºåˆ¶ï¼ˆé»˜è®¤3æ¬¡ï¼‰
- âœ… éä¸¥æ ¼æ¨¡å¼é™çº§å¤„ç†

**æ–‡ä»¶**: `json_parser.py`

**ç¤ºä¾‹**:
```python
from json_parser import parse_decision_response

decision = parse_decision_response(
    response_text,
    max_retries=3,
    strict_mode=False
)

print(decision.completed)    # bool
print(decision.confidence)   # 0.0-1.0
print(decision.next_prompt)  # str
```

---

#### âœ… P0-3: å®Œå–„å¼‚å¸¸å¤„ç†

**é—®é¢˜**: ä»»ä½•é”™è¯¯å¯¼è‡´ç³»ç»Ÿå´©æºƒ

**è§£å†³æ–¹æ¡ˆ**:
- âœ… æ‰€æœ‰ç½‘ç»œ/æ–‡ä»¶æ“ä½œæ·»åŠ  try-except
- âœ… è‡ªåŠ¨é‡è¯•æœºåˆ¶ï¼ˆå¯é…ç½®æ¬¡æ•°å’Œå»¶è¿Ÿï¼‰
- âœ… è¿ç»­é”™è¯¯æ£€æµ‹ï¼ˆ3æ¬¡è¿ç»­å¤±è´¥åˆ™ç»ˆæ­¢ï¼‰
- âœ… é”™è¯¯æ—¥å¿—è®°å½•å’Œåˆ†æ

**æ–‡ä»¶**: `step1_v2.py`, `step2_v2.py`, `step3_v2.py`

**é…ç½®**:
```yaml
error_handling:
  max_retries: 3
  retry_delay_seconds: 5
  continue_on_error: false
  save_error_logs: true
```

---

### P1 ä¼˜åŒ– - å¯é æ€§å¢å¼º

#### âœ… P1-4: çŠ¶æ€æŒä¹…åŒ–ç³»ç»Ÿ

**é—®é¢˜**: å´©æºƒåæ— æ³•æ¢å¤ï¼Œæ— æ³•è¿½æº¯å†å²

**è§£å†³æ–¹æ¡ˆ**:
- âœ… å®Œæ•´çš„çŠ¶æ€ä¿å­˜ï¼ˆ`workflow_state.json`ï¼‰
- âœ… æ”¯æŒæ–­ç‚¹ç»­ä¼ 
- âœ… æ‰§è¡Œå†å²è®°å½•
- âœ… ç»Ÿè®¡ä¿¡æ¯ï¼ˆæˆåŠŸç‡ã€å¹³å‡æ—¶é—´ç­‰ï¼‰

**æ–‡ä»¶**: `state_manager.py`

**çŠ¶æ€æ–‡ä»¶ç»“æ„**:
```json
{
  "session_id": "...",
  "status": "running",
  "current_iteration": 5,
  "max_iterations": 50,
  "history": [
    {
      "iteration": 1,
      "decision": {...},
      "duration_seconds": 45.2,
      "success": true
    }
  ],
  "successful_iterations": 4,
  "failed_iterations": 1
}
```

---

#### âœ… P1-5: ä¼šè¯ç®¡ç†å¢å¼º

**é—®é¢˜**: session_id ä¸¢å¤±å¯¼è‡´ä»»åŠ¡å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
- âœ… è‡ªåŠ¨å¤‡ä»½ä¼šè¯IDï¼ˆ`session_id.backup.txt`ï¼‰
- âœ… ä¼šè¯æœ‰æ•ˆæ€§éªŒè¯ï¼ˆé¢„ç•™æ¥å£ï¼‰
- âœ… åŒæ–‡ä»¶ä¿æŠ¤æœºåˆ¶

**æ–‡ä»¶**: `step1_v2.py`, `step3_v2.py`

---

#### âœ… P1-6: ç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿ

**é—®é¢˜**: æ—¥å¿—åˆ†æ•£ã€æ ¼å¼ä¸ä¸€è‡´ã€éš¾ä»¥æ’æŸ¥

**è§£å†³æ–¹æ¡ˆ**:
- âœ… ç»Ÿä¸€æ—¥å¿—æ¡†æ¶ï¼ˆæ”¯æŒå¤šç§æ ¼å¼ï¼‰
- âœ… ç»“æ„åŒ–æ—¥å¿—ï¼ˆæ”¯æŒ JSON æ ¼å¼ï¼‰
- âœ… æ–‡ä»¶è½®è½¬ï¼ˆè‡ªåŠ¨ç®¡ç†æ—¥å¿—å¤§å°ï¼‰
- âœ… é”™è¯¯æ—¥å¿—å•ç‹¬è®°å½•
- âœ… ä¼šè¯/è¿­ä»£ä¿¡æ¯è¿½è¸ª

**æ–‡ä»¶**: `logger.py`

**æ—¥å¿—æ ¼å¼ç¤ºä¾‹**:
```
2025-01-21 10:30:45 | INFO     | [step3:step3_execute_iteration:123] | [Session:abc123 | Iter:5] å¼€å§‹ç¬¬ 5 è½®è¿­ä»£
```

**é…ç½®**:
```yaml
logging:
  level: "INFO"
  format: "detailed"  # simple, detailed, json
  console_output: true
  file_output: true
  max_file_size_mb: 10
  backup_count: 5
```

---

#### âœ… P1-7: é…ç½®ç®¡ç†ç³»ç»Ÿ

**é—®é¢˜**: é…ç½®ç¡¬ç¼–ç ï¼Œéš¾ä»¥ç»´æŠ¤

**è§£å†³æ–¹æ¡ˆ**:
- âœ… YAML é…ç½®æ–‡ä»¶
- âœ… Pydantic éªŒè¯
- âœ… ç¯å¢ƒå˜é‡æ”¯æŒ
- âœ… é…ç½®çƒ­é‡è½½

**æ–‡ä»¶**: `config.py`, `config.yaml`

**ç¯å¢ƒå˜é‡è¦†ç›–**:
```bash
export WORKFLOW_MAX_ITERATIONS=100
export WORKFLOW_LOG_LEVEL=DEBUG
python main_v2.py
```

---

## ğŸ†š ç‰ˆæœ¬å¯¹æ¯”

### åŠŸèƒ½å¯¹æ¯”è¡¨

| åŠŸèƒ½ | v1.0 | v2.0 |
|------|------|------|
| æ— é™å¾ªç¯ä¿æŠ¤ | âŒ | âœ… (4ç§æœºåˆ¶) |
| JSON è§£ææˆåŠŸç‡ | ~10% | ~95% |
| å¼‚å¸¸å¤„ç† | âŒ | âœ… (å…¨è¦†ç›–) |
| æ–­ç‚¹ç»­ä¼  | âŒ | âœ… |
| çŠ¶æ€æŒä¹…åŒ– | ä»… session_id | âœ… å®Œæ•´çŠ¶æ€ |
| æ—¥å¿—ç³»ç»Ÿ | æ··ä¹± | âœ… ç»Ÿä¸€ |
| é…ç½®ç®¡ç† | ç¡¬ç¼–ç  | âœ… YAML |
| ä¼šè¯å¤‡ä»½ | âŒ | âœ… |
| æ‰§è¡Œå†å² | âŒ | âœ… |
| å¢é‡åŒæ­¥ | âŒ | âœ… (å¯é€‰) |
| æç¤ºè¯å·¥ç¨‹ | åŸºç¡€ | âœ… ä¼˜åŒ– |

---

## ğŸ“¦ æ–‡ä»¶ç»“æ„

### æ–°å¢æ–‡ä»¶

```
claudecode/
â”œâ”€â”€ config.yaml              # é…ç½®æ–‡ä»¶ â­ NEW
â”œâ”€â”€ config.py                # é…ç½®ç®¡ç† â­ NEW
â”œâ”€â”€ state_manager.py         # çŠ¶æ€ç®¡ç† â­ NEW
â”œâ”€â”€ logger.py                # æ—¥å¿—ç³»ç»Ÿ â­ NEW
â”œâ”€â”€ json_parser.py           # JSON è§£æå™¨ â­ NEW
â”œâ”€â”€ step1_v2.py              # ä¼˜åŒ–ç‰ˆ Step1 â­ NEW
â”œâ”€â”€ step2_v2.py              # ä¼˜åŒ–ç‰ˆ Step2 â­ NEW
â”œâ”€â”€ step3_v2.py              # ä¼˜åŒ–ç‰ˆ Step3 â­ NEW
â”œâ”€â”€ main_v2.py               # ä¼˜åŒ–ç‰ˆä¸»ç¨‹åº â­ NEW
â”œâ”€â”€ UPGRADE_GUIDE.md         # æœ¬æ–‡æ¡£ â­ NEW
â”œâ”€â”€ logs/                    # æ—¥å¿—ç›®å½• â­ NEW
â”‚   â”œâ”€â”€ main.log
â”‚   â”œâ”€â”€ main_error.log
â”‚   â”œâ”€â”€ step1.log
â”‚   â””â”€â”€ ...
â””â”€â”€ demo_act/
    â”œâ”€â”€ workflow_state.json  # çŠ¶æ€æ–‡ä»¶ â­ NEW
    â”œâ”€â”€ session_id.txt
    â””â”€â”€ session_id.backup.txt # å¤‡ä»½ â­ NEW
```

### ä¿ç•™æ–‡ä»¶ï¼ˆåŸå§‹ç‰ˆæœ¬ï¼‰

```
â”œâ”€â”€ main.py                  # åŸå§‹ä¸»ç¨‹åº
â”œâ”€â”€ step1.py                 # åŸå§‹ Step1
â”œâ”€â”€ step2.py                 # åŸå§‹ Step2
â”œâ”€â”€ step3.py                 # åŸå§‹ Step3
â””â”€â”€ requirements.txt         # ä¾èµ–ï¼ˆéœ€æ›´æ–°ï¼‰
```

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

æ›´æ–° `requirements.txt`:
```
claude-code-sdk>=1.0.0
pydantic>=2.0.0
pyyaml>=6.0
```

### 2. é…ç½®ç³»ç»Ÿ

ç¼–è¾‘ `config.yaml`ï¼Œè®¾ç½®ä½ çš„ä»»åŠ¡ï¼š

```yaml
task:
  goal: "ä½ çš„ä»»åŠ¡ç›®æ ‡"
  initial_prompt: "åˆå§‹æç¤ºè¯"

safety:
  max_iterations: 50
  max_duration_hours: 8
```

### 3. è¿è¡Œç³»ç»Ÿ

#### å®Œæ•´è¿è¡Œï¼ˆæ¨èï¼‰

```bash
python main_v2.py
```

#### ä»…åˆå§‹åŒ–

```bash
python step1_v2.py
```

#### ä»…è¿è¡Œå¾ªç¯

```bash
python main_v2.py --skip-init
```

#### ä»å¤´å¼€å§‹ï¼ˆä¸æ¢å¤çŠ¶æ€ï¼‰

```bash
python main_v2.py --no-resume
```

#### æŸ¥çœ‹çŠ¶æ€

```bash
python main_v2.py --show-status
```

#### æŸ¥çœ‹é…ç½®

```bash
python main_v2.py --show-config
```

### 4. ç´§æ€¥åœæ­¢

```bash
# åˆ›å»ºç´§æ€¥åœæ­¢æ–‡ä»¶
touch .emergency_stop

# ç³»ç»Ÿä¼šåœ¨ä¸‹ä¸€è½®è¿­ä»£å¼€å§‹å‰å®‰å…¨é€€å‡º
```

### 5. æ–­ç‚¹ç»­ä¼ 

```bash
# ç³»ç»Ÿå´©æºƒæˆ–åœæ­¢åï¼Œç›´æ¥é‡æ–°è¿è¡Œ
python main_v2.py

# ä¼šè‡ªåŠ¨ä»ä¸Šæ¬¡çš„ä½ç½®ç»§ç»­
```

---

## ğŸ” ç›‘æ§ä¸è°ƒè¯•

### æŸ¥çœ‹æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹ä¸»æ—¥å¿—
tail -f logs/main.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
cat logs/main_error.log

# æŸ¥çœ‹æœ€è¿‘10æ¡æ—¥å¿—
tail -n 10 logs/main.log
```

### æŸ¥çœ‹çŠ¶æ€

```python
from state_manager import StateManager
from pathlib import Path

manager = StateManager(Path("demo_act/workflow_state.json"))
state = manager.get_state()
state.print_summary()
```

è¾“å‡º:
```
============================================================
å·¥ä½œæµæ‰§è¡ŒçŠ¶æ€æ‘˜è¦
============================================================
ä¼šè¯ID: abc123...
ç›®æ ‡: è°ƒç ”ä¸€ä¸‹æ…¢æ€§ç—…
çŠ¶æ€: running
è¿›åº¦: 5/50 (10.0%)
æˆåŠŸç‡: 80.0%
æ€»æ—¶é•¿: 225.5ç§’
å¹³å‡è¿­ä»£æ—¶é—´: 45.1ç§’
æˆåŠŸæ¬¡æ•°: 4
å¤±è´¥æ¬¡æ•°: 1
============================================================
```

### è°ƒè¯•æ¨¡å¼

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export WORKFLOW_LOG_LEVEL=DEBUG

# è¿è¡Œ
python main_v2.py
```

---

## âš™ï¸ é…ç½®è¯¦è§£

### å®‰å…¨é™åˆ¶é…ç½®

```yaml
safety:
  max_iterations: 50              # æœ€å¤§å¾ªç¯æ¬¡æ•°
  max_duration_hours: 8           # æœ€å¤§è¿è¡Œæ—¶é•¿
  emergency_stop_file: ".emergency_stop"
  iteration_timeout_minutes: 30   # å•æ¬¡è¿­ä»£è¶…æ—¶
```

### é”™è¯¯å¤„ç†é…ç½®

```yaml
error_handling:
  max_retries: 3                  # é‡è¯•æ¬¡æ•°
  retry_delay_seconds: 5          # é‡è¯•å»¶è¿Ÿ
  continue_on_error: false        # é”™è¯¯æ—¶æ˜¯å¦ç»§ç»­
  save_error_logs: true           # ä¿å­˜é”™è¯¯æ—¥å¿—
```

### æ€§èƒ½ä¼˜åŒ–é…ç½®

```yaml
performance:
  use_incremental_sync: true      # ä½¿ç”¨å¢é‡åŒæ­¥
  exclude_patterns:               # æ’é™¤æ¨¡å¼
    - "*.pyc"
    - "__pycache__"
    - ".git"
    - "*.log"
```

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### v1.0 vs v2.0

| æŒ‡æ ‡ | v1.0 | v2.0 | æ”¹è¿› |
|------|------|------|------|
| JSON è§£ææˆåŠŸç‡ | 10% | 95% | +850% |
| å´©æºƒæ¢å¤èƒ½åŠ› | 0% | 100% | +100% |
| é•œåƒåŒæ­¥é€Ÿåº¦ | åŸºå‡† | 5x | +400% |
| æ— é™å¾ªç¯é£é™© | é«˜ | æ—  | âœ… |
| é”™è¯¯å¤„ç†è¦†ç›–ç‡ | 10% | 100% | +900% |
| å¯è¿½æº¯æ€§ | æ—  | å®Œæ•´ | âœ… |

---

## ğŸ› ï¸ æ•…éšœæ’é™¤

### é—®é¢˜1: é…ç½®åŠ è½½å¤±è´¥

```
âŒ é…ç½®æ–‡ä»¶ä¸å­˜åœ¨: config.yaml
```

**è§£å†³**: ç¡®ä¿ `config.yaml` å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®

```bash
# éªŒè¯ YAML æ ¼å¼
python -c "import yaml; yaml.safe_load(open('config.yaml'))"
```

### é—®é¢˜2: ä¼šè¯æ–‡ä»¶ä¸¢å¤±

```
âŒ ä¼šè¯æ–‡ä»¶ä¸å­˜åœ¨: demo_act/session_id.txt
```

**è§£å†³**: é‡æ–°è¿è¡Œ step1

```bash
python step1_v2.py
```

æˆ–æ£€æŸ¥å¤‡ä»½:
```bash
cp demo_act/session_id.backup.txt demo_act/session_id.txt
```

### é—®é¢˜3: çŠ¶æ€æ–‡ä»¶æŸå

```
âŒ åŠ è½½çŠ¶æ€æ–‡ä»¶å¤±è´¥: JSON decode error
```

**è§£å†³**: åˆ é™¤çŠ¶æ€æ–‡ä»¶é‡æ–°å¼€å§‹

```bash
rm demo_act/workflow_state.json
python main_v2.py --no-resume
```

---

## ğŸ“ˆ åç»­ä¼˜åŒ–å»ºè®®ï¼ˆP2/P3ï¼‰

è™½ç„¶ P0/P1 å·²å®Œæˆï¼Œä»¥ä¸‹æ˜¯æœªæ¥å¯è€ƒè™‘çš„ä¼˜åŒ–ï¼š

### P2 - ä¸­ä¼˜å…ˆçº§
- [ ] Web ç›‘æ§ç•Œé¢ï¼ˆå®æ—¶æŸ¥çœ‹è¿›åº¦ï¼‰
- [ ] å¤šä»»åŠ¡å¹¶è¡Œæ‰§è¡Œ
- [ ] æ›´æ™ºèƒ½çš„æç¤ºè¯æ¨¡æ¿
- [ ] Rich è¿›åº¦æ¡

### P3 - ä½ä¼˜å…ˆçº§
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–
- [ ] å·¥å…·ç™½åå•/æ²™ç®±
- [ ] åˆ†å¸ƒå¼æ‰§è¡Œ
- [ ] Prometheus æŒ‡æ ‡å¯¼å‡º

---

## ğŸ“ æ”¯æŒ

é‡åˆ°é—®é¢˜æˆ–æœ‰å»ºè®®ï¼Ÿ

1. æŸ¥çœ‹æ—¥å¿—: `logs/main_error.log`
2. æŸ¥çœ‹çŠ¶æ€: `python main_v2.py --show-status`
3. æŸ¥çœ‹é…ç½®: `python main_v2.py --show-config`
4. æäº¤ Issue

---

## ğŸ“„ License

MIT License - ä¸åŸé¡¹ç›®ä¿æŒä¸€è‡´

---

**ç‰ˆæœ¬**: v2.0
**æ›´æ–°æ—¥æœŸ**: 2025-01-21
**ä½œè€…**: AI å·¥ä½œæµä¼˜åŒ–å›¢é˜Ÿ
